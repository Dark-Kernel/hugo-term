<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Docker :: Sumit Patel</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Almost Everything you need to know about docker." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://dark-kernel.web.app/post/docker-concepts/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://dark-kernel.web.app/styles.css">







  <link rel="shortcut icon" href="https://dark-kernel.web.app/profile.jpg">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Docker">
<meta property="og:description" content="Almost Everything you need to know about docker." />
<meta property="og:url" content="https://dark-kernel.web.app/post/docker-concepts/" />
<meta property="og:site_name" content="Sumit Patel" />

  
    <meta property="og:image" content="https://dark-kernel.web.app/profile.jpg">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2023-08-06 00:00:00 &#43;0000 UTC" />












</head>
<body class="pink">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Sumit Patel
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about/">About</a></li>
        
      
        
          <li><a href="/post">Post</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about/" >About</a></li>
        
      
        
          <li><a href="/post" >Post</a></li>
        
      
        
          <li><a href="/showcase" >Showcase</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://dark-kernel.web.app/post/docker-concepts/">Docker</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-08-06</time><span class="post-author">Sumit Patel</span></div>

  
    <span class="post-tags">
      
      #<a href="https://dark-kernel.web.app/tags/docker/">Docker</a>&nbsp;
      
      #<a href="https://dark-kernel.web.app/tags/networking/">Networking</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h1 id="docker">Docker<a href="#docker" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>These are required from fresher DevOps.</p>
</blockquote>
<p>Used in deployment using containerization method. To run an application in isolated environment.</p>
<ul>
<li>
<p>Docker engine is connected to host kernel</p>
</li>
<li>
<p>No need to allocate resources, Uses shared resources.</p>
</li>
<li>
<p>Components:</p>
<ol>
<li>dockerd -&gt; Executed in background and use containerd to manage containers.</li>
<li>dockercli -&gt; an interface for docker.</li>
<li>containerd -&gt; lowest level.</li>
</ol>
</li>
</ul>
<blockquote>
<p>Docker engine is service which allow you to run any OS, which uses dockercli and dockerd</p>
</blockquote>
<h4 id="basic-commands">Basic commands:<a href="#basic-commands" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>
<p>Run a container by pulling image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo docker run -d -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span>test@123 mysql:latest
</span></span></code></pre></div></li>
<li>
<p>To get lists running containers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker ps 
</span></span></code></pre></div><p>You can use <code>-a</code> option to list stopped containers aswell.</p>
</li>
<li>
<p>To get access to container use below command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker exec -it &lt;containerid&gt; sh
</span></span></code></pre></div></li>
<li>
<p>Command to stop &amp; remove container</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Stop</span>
</span></span><span style="display:flex;"><span>docker stop &lt;containerid&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># remove</span>
</span></span><span style="display:flex;"><span>docker remove &lt;containerid&gt;
</span></span></code></pre></div></li>
<li>
<p>To remove all unused images.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker image prune
</span></span></code></pre></div></li>
<li>
<p>To remove all stopped containers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker container prune
</span></span></code></pre></div></li>
</ul>
<blockquote>
<p>prune, can be used to remove unused images, containers, network, etc. Mostly used to clear the disk space.</p>
</blockquote>
<ul>
<li>We can also force to remove
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker image prune --all --force
</span></span></code></pre></div></li>
</ul>
<p> </p>
<hr>
<p> </p>
<h2 id="docker-advanced">Docker Advanced.<a href="#docker-advanced" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>These are required from senior DevOps.</p>
</blockquote>
<ul>
<li>Volumnes</li>
<li>Network</li>
<li>Compose (2/3 tier)</li>
<li>Multistage docker build</li>
<li>Docker push to docker hub</li>
</ul>
<h3 id="1-docker-volumes">1. Docker Volumes<a href="#1-docker-volumes" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>It stores a copy of your container to your system too.
So whenever docker container crashes this copy can be used.</p>
<blockquote>
<p>Data is stored in container till it is in running status, after container is exited data is gone. That&rsquo;s why docker volume is used to save data.</p>
</blockquote>
<p>Example:</p>
<ol>
<li>
<p>Clone an app and deploy with docker.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/LondheShubham153/django-todo-cicd.git
</span></span><span style="display:flex;"><span>cd django-todo-cicd
</span></span><span style="display:flex;"><span>docker build . -t django-app
</span></span><span style="display:flex;"><span>docker run -d -p 8000:8000 django-app:latest
</span></span></code></pre></div><p>Now when if we create new container of same image, our data will be vanished. So to avoid this we can create and mount volume devices to containers to continue with same data.</p>
</li>
<li>
<p>Create directory, where we will store data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /var/django-app
</span></span></code></pre></div></li>
<li>
<p>Create volume</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker volume create django-app-volume --opt type<span style="color:#f92672">=</span>none --opt device<span style="color:#f92672">=</span>/home/user/django-app/ --opt o<span style="color:#f92672">=</span>bind  
</span></span></code></pre></div><ul>
<li>device: location, s3, disk or direcory</li>
<li>o=bind: two way communication, if you update someting on device or container both will be synced.</li>
</ul>
</li>
<li>
<p>List volumes, <code>local</code> is default volume.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker volume ls 
</span></span></code></pre></div></li>
<li>
<p>Mount volume to container.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --mount source<span style="color:#f92672">=</span>django-app-volume,target<span style="color:#f92672">=</span>/data -p 8000:8000 django-app:latest
</span></span></code></pre></div><ul>
<li>target: to which we want to you want to store in volumnet</li>
</ul>
</li>
</ol>
<blockquote>
<p>Volume device data and container&rsquo;s data is synced in real time.</p>
</blockquote>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Get into container:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker exec -it &lt;id&gt; bash
</span></span></code></pre></div></li>
<li>
<p>Do some changes, like create new file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;super secret&#34;</span> &gt; file.txt
</span></span><span style="display:flex;"><span>exit
</span></span></code></pre></div></li>
</ul>
<p>Now, check on device location, and changes will be reflected there. Every data will be synced.
<strong>This is called data persistence.</strong></p>
<p> </p>
<hr>
<p> </p>
<h3 id="2-docker-networking">2. Docker networking<a href="#2-docker-networking" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Used to create a network where we can connect multiple application.</p>
<p>Types:</p>
<ul>
<li>Default bridge</li>
<li>Custom bridge (User defined)</li>
<li>Host network</li>
<li>Mac VLAN network</li>
<li>None</li>
<li>Overlay</li>
<li>IPVLan</li>
</ul>
<p>When you install docker new interface is created something like <code>docker0</code>.</p>
<p>When you create new container, it is gone through docker network to access on other interfaces.</p>
<ul>
<li>List docker networks</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network ls 
</span></span></code></pre></div><blockquote>
<p>By default 3 types of network are already present in docker, Other needs to be created.
<strong>Bridge is used by default.</strong></p>
</blockquote>
<h4 id="1-default-bridge">1. Default bridge:<a href="#1-default-bridge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Provide internet access from inside, other can&rsquo;t access from outside until you publish any port.
when you bridge network is used docker0 interface create a bridge network with your active interface and then we have to bind ports to access.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d -p 80:80 nginx
</span></span></code></pre></div><h4 id="2-custom-bridge">2. Custom bridge<a href="#2-custom-bridge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Used to create isolated network environment.
It is used to created a application group, where containers can access each other who are in that network</p>
<p>Create custom bridge:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create myapp
</span></span></code></pre></div><p>Run container using custom bridge:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --network myapp nginx
</span></span><span style="display:flex;"><span>docker run -d --network myapp mysql 
</span></span></code></pre></div><p>Now nginx &amp; mysql can communicate easily, even with name of container.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker inspect myapp
</span></span></code></pre></div><h4 id="3-host">3. Host<a href="#3-host" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --network host nginx
</span></span></code></pre></div><p>When you using host network container directorly connects to your systems networks instead of docker0, This means that container is running same as an application which is using some port like nodejs app or mysql which are accessible on your host network.
It is running on hosts ip.</p>
<h4 id="4-mac-vlan">4. Mac VLAN<a href="#4-mac-vlan" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>Modes: bridge &amp; 802.1q</strong></p>
<p>If you want to associate your container with Mac address, to pretend like a device not container.
It simply allows containers to have a Mac address this allow containers to appear as physical device.</p>
<blockquote>
<p>Directly connect you docker container with your physical network. (router,switch)</p>
</blockquote>
<h6 id="bridge-default">bridge (default):<a href="#bridge-default" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h6>
<p>Create network</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create -d macvlan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--subnet<span style="color:#f92672">=</span>&lt;subnet&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--gateway<span style="color:#f92672">=</span>&lt;gateway&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o parent<span style="color:#f92672">=</span>eth0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>my-vlan 
</span></span></code></pre></div><ul>
<li><code>-o</code> for options.</li>
<li>parent is the physical network interface like wlan0, eth0. enp5s0, etc.</li>
</ul>
<p>User network</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -itd --rm --network my-vlan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--ip 192.168.0.33 
</span></span><span style="display:flex;"><span>--name myapp
</span></span><span style="display:flex;"><span>nginx
</span></span></code></pre></div><p>Now, if you try to ping your other network device from container you might face issue,</p>
<p>This is the downside of <code>Macvlan</code>:
Your containers have different mac but they share same port socket on physical network, It breaks the security because you can have only 1 or 2 mac address on one port and that&rsquo;s what cause the issue.</p>
<p>To fix this we have to enable promiscuous mode.</p>
<ul>
<li>First enable it on physical network</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo ip link set enp0s3 promisc on 
</span></span></code></pre></div><ul>
<li>reboot your host.</li>
</ul>
<p>Now it is directly connected to your home network/ physical network, You can directly use the ip.</p>
<h6 id="8021q">802.1q:<a href="#8021q" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h6>
<p>By using second type you can create a subinterface from your physical which contains there own network.</p>
<ul>
<li>Create Macvlan with 802.1q mode network</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create -d macvlan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--subnet<span style="color:#f92672">=</span>&lt;subnet&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--gateway<span style="color:#f92672">=</span>&lt;gateway&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o parent<span style="color:#f92672">=</span>eth0.20 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>my-vlan 
</span></span></code></pre></div><h4 id="5-none">5. None<a href="#5-none" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Used to create an application with no internet access, with no incoming and outgoing traffic. If you want to create a dummy data container you can use this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --network none nginx
</span></span></code></pre></div><h4 id="6-overlay">6. Overlay<a href="#6-overlay" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Used for communication between multiple docker daemon hosts. This helps containers running on different hosts to communicate easily.  Example: k8s cluster, docker swarm, etc.</p>
<p><strong>Create and use:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create --driver<span style="color:#f92672">=</span>overlay my-overlay-network
</span></span><span style="display:flex;"><span>docker run -d --network<span style="color:#f92672">=</span>my-overlay-network my-service
</span></span></code></pre></div><h4 id="7-ipvlan">7. IPVLan<a href="#7-ipvlan" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>This solves the Macvlan problem promiscuous stuffs.</p>
<p><strong>Modes: L2 &amp; L3</strong></p>
<h6 id="l2">L2:<a href="#l2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h6>
<p>Its same like Macvlan, there are assingned mac, they allow the host to share its macaddress with the containers, It means your mac address with exactly match with your host but will have ip address on network.</p>
<p><strong>Create network:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create -d ipvlan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--subnet<span style="color:#f92672">=</span>10.7.1.0/24 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--gateway<span style="color:#f92672">=</span>10.7.1.3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o parent<span style="color:#f92672">=</span>enp0s3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>my-ipvlan
</span></span></code></pre></div><p><strong>Use in containers:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -itd --rm --network my-ipvlan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--ip 10.7.1.92
</span></span><span style="display:flex;"><span>--name myapp busybox
</span></span></code></pre></div><h6 id="l3">L3:<a href="#l3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h6>
<p>Its all about layer3, We are connecting to host, host as a router. they connect to host physical network interfac. they connect to host physical network interface, This means no broadcast traffic not going to repond arp requests.
The problem is, it cannot access internet and not anyone can access it. Because it is not in routing table, then why to deploy? Everyting is a game of more control you can do some crazy isolation with your containers.</p>
<p><strong>Create network:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create -d ipvlan <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--subnet<span style="color:#f92672">=</span>192.168.94.0/24 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-o parent<span style="color:#f92672">=</span>enp0s3 -o ipvlan_mode<span style="color:#f92672">=</span>l3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--subnet<span style="color:#f92672">=</span>192.168.95.0/24
</span></span><span style="display:flex;"><span>my-ipvlanl3
</span></span></code></pre></div><ul>
<li>Here we used two subnets, because we have to do that if want to create more than 1 network which are going to use the same physical interface</li>
</ul>
<p><strong>Use in container:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -itd --rm --network my-ipvlanl3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--ip 192.168.94.7
</span></span><span style="display:flex;"><span>--name myapp
</span></span><span style="display:flex;"><span>busybox
</span></span></code></pre></div><p>If you have more than one subnet you need to specify the ip address,
Here both the subnet can talk to each other.</p>
<p>Now, to give access to the internet we need add a new static routing in your router page.</p>
<hr>
<p> </p>
<h3 id="3-docker-compose">3. Docker compose.<a href="#3-docker-compose" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Used to run multiple container/microservices and different tier application.</p>
<blockquote>
<p>3 tier application architecture:</p>
</blockquote>
<pre><code>1. presentation layer/tier (UI/Frontend)
2. Business layer/tier (Backend)
3. Database layer/tier
</code></pre>
<blockquote>
<p>2 tier application</p>
</blockquote>
<pre><code>1. Backend
2. DB
</code></pre>
<blockquote>
<p>Configuration language: YML/YAML (key: value)</p>
</blockquote>
<p>We need YAML language to write docker-compose file, which contains all the stages and everything including ports, volumes, networks, etc.</p>
<p>Syntax:</p>
<p>


  <div class="collapsable-code">
    <input id="1" type="checkbox"  />
    <label for="1">
      <span class="collapsable-code__language">yaml</span>
      <span class="collapsable-code__title">docker-compose.yml</span>
      <span class="collapsable-code__toggle" data-label-expand="△" data-label-collapse="▽"></span>
    </label>
    <pre class="language-yaml" ><code>
version: &#39;3&#39;
services: 
    backend: 
        build: 
            context: . # Dockerfile exist in current dir.
        ports:
            - 5000:5000
    mysql:
        image: mysql:5.7
        volumes: 
            - mysql-data:/var/storage # to use volume
</code></pre>
  </div>


Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/LondheShubham153/two-tier-flask-app.git 
</span></span><span style="display:flex;"><span>cd two-tier-flask-app
</span></span></code></pre></div><p>Create env file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim .env
</span></span></code></pre></div>


  <div class="collapsable-code">
    <input id="1" type="checkbox"  />
    <label for="1">
      <span class="collapsable-code__language">env</span>
      <span class="collapsable-code__title">.env</span>
      <span class="collapsable-code__toggle" data-label-expand="△" data-label-collapse="▽"></span>
    </label>
    <pre class="language-env" ><code>
MYSQL_HOST=mysql
MYSQL_USER=your_username
MYSQL_PASSWORD=your_password
MYSQL_DB=your_database
</code></pre>
  </div>


<p>To start container run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker-compose up --build
</span></span></code></pre></div><p>To stop run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker-compose down
</span></span></code></pre></div><p> </p>
<hr>
<p> </p>
<h3 id="4-multistage-docker-build">4. Multistage docker build<a href="#4-multistage-docker-build" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Multistage is used to reduce the size of docker image.
We use multiple <code>FROM</code> or base images for different steps as per requirements.
Dockerfile is single stage build.</p>
<p>we use <code>FROM</code> to get base image, after the work of base image is done, use another <code>FROM</code>.
So the first <code>FROM</code> becomes stage1 and compressed to binary, and is injected to next stage by using <code>COPY</code>.</p>
<h4 id="normal-single-stage-build">Normal Single stage build:<a href="#normal-single-stage-build" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>


  <div class="collapsable-code">
    <input id="1" type="checkbox"  />
    <label for="1">
      <span class="collapsable-code__language">dockerfile</span>
      <span class="collapsable-code__title">Dockerfile</span>
      <span class="collapsable-code__toggle" data-label-expand="△" data-label-collapse="▽"></span>
    </label>
    <pre class="language-dockerfile" ><code>
FROM python:3.9
WORKDIR app
COPY . .
RUN pip install flask
CMD [&#34;python&#34;,&#34;app.py&#34;]
</code></pre>
  </div>


Build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker build . -t normal-flask
</span></span></code></pre></div><p><strong>size: 1.01GB</strong></p>
<h4 id="after-making-it-multistage-build">After making it Multistage build:<a href="#after-making-it-multistage-build" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># Stage 1</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.9 AS big-stage</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Stage 2</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.9-slim-bullseye </span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>big-stage /app /app<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pip install flask<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;python&#34;</span>,<span style="color:#e6db74">&#34;app.py&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Build:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker build . -t multi-flask
</span></span></code></pre></div><p><strong>size: 135M</strong></p>
<p>Check the difference:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker images | grep flask
</span></span><span style="display:flex;"><span>multi-flask     latest   0b5e33bbbf39   About a minute ago   135MB
</span></span><span style="display:flex;"><span>normal-flask    latest   9a499f6df793   <span style="color:#ae81ff">5</span> minutes ago        1.01GB
</span></span></code></pre></div><p> </p>
<hr>
<h3 id="5-docker-push">5. Docker push<a href="#5-docker-push" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ol>
<li>
<p>Create new account in <a href="hub.docker.com">Dockerhub</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker login
</span></span></code></pre></div></li>
<li>
<p>Login with your username and password.</p>
</li>
<li>
<p>Tag your image correctly to push, replace <code>user</code> with your username:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker image tag multi-flask:latest user/multi-flask-app:latest
</span></span></code></pre></div></li>
<li>
<p>Finally push it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker push &lt;user&gt;/multi-flask-app
</span></span></code></pre></div></li>
</ol>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="https://dark-kernel.web.app/post/firefox-hardening/">
                <span class="button__text">Firefox Hardening</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
  
</article>





  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2023 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
